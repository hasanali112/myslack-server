generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id        String          @id @default(uuid())
  email          String          @unique
  password       String
  username       String          @unique
  avatar         String?
  status         UserStatus      @default(OFFLINE)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  messages       Message[]
  channelMembers ChannelMember[]

  @@map("users")
}

model Channel {
  channel_id     String          @id @default(uuid())
  name           String          @unique
  description    String?
  type           ChannelType     @default(PUBLIC)
  isDM           Boolean         @default(false)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  messages       Message[]
  channelMembers ChannelMember[]

  @@map("channels")
}

model ChannelMember {
  channel_member_id String   @id @default(uuid())
  user_id           String
  channel_id        String
  role              Role     @default(MEMBER)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  channel           Channel  @relation(fields: [channel_id], references: [channel_id], onDelete: Cascade)

  @@unique([user_id, channel_id])
  @@map("channel_members")
}

model Message {
  message_id String   @id @default(uuid())
  content    String   @db.Text
  sender_id  String
  channel_id String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  sender     User     @relation(fields: [sender_id], references: [user_id], onDelete: Cascade)
  channel    Channel  @relation(fields: [channel_id], references: [channel_id], onDelete: Cascade)

  @@map("messages")
}

// Enums
enum UserStatus {
  ONLINE
  OFFLINE
}

enum ChannelType {
  PUBLIC
  PRIVATE
}

enum Role {
  ADMIN
  MEMBER
}
